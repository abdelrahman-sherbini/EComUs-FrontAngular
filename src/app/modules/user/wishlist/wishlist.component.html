<div class="wishlist-container">
  <!-- Header - only show if not hidden -->
  <div class="wishlist-header" *ngIf="!hideHeader">
    <div class="header-content">
      <h1>My Wishlist</h1>
      <p *ngIf="!loading && wishlistItems.length > 0">
        Items you've saved for later
      </p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Search and Filters -->
    <div class="filters-section">
      <div class="search-bar">
        <input
          type="text"
          [(ngModel)]="searchKeyword"
          placeholder="Search products..."
          class="search-input"
          (keyup.enter)="onSearch()">
        <button (click)="onSearch()" class="search-btn">Search</button>
      </div>

      <div class="filters">
        <div class="filter-group">
          <label>Category:</label>
          <select [(ngModel)]="selectedCategory" (change)="onSearch()">
            <option value="">All Categories</option>
            <option value="clothing">Clothing</option>
            <option value="accessories">Accessories</option>
          </select>
        </div>

        <div class="filter-group">
          <label>Price Range:</label>
          <input type="number" [(ngModel)]="priceMin" placeholder="Min" class="price-input" (change)="onSearch()">
          <input type="number" [(ngModel)]="priceMax" placeholder="Max" class="price-input" (change)="onSearch()">
        </div>

        <div class="filter-group">
          <label>Sort By:</label>
          <select [(ngModel)]="sortField" (change)="onSortChange()">
            <option value="productId">Product ID</option>
            <option value="productName">Product Name</option>
            <option value="price">Price</option>
          </select>
          <select [(ngModel)]="sortDir" (change)="onSortChange()">
            <option value="asc">Ascending</option>
            <option value="desc">Descending</option>
          </select>
        </div>

        <button (click)="clearFilters()" class="clear-btn">Clear Filters</button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading">
      <p>Loading your wishlist...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="error">
      <p>{{ error }}</p>
      <button (click)="forceRefresh()" class="retry-btn">Retry</button>
    </div>

    <!-- Products Grid -->
    <div *ngIf="!loading && !error" class="products-grid">
      <div *ngFor="let product of wishlistItems" class="product-card">
        <!-- Sale Badge - Only show if needed -->
        <div *ngIf="product.price && product.price < 100" class="sale-badge">
          SALE
        </div>

        <!-- Product Image - Make clickable -->
        <div class="product-image" (click)="navigateToProductDetails(product.productId!)">
          <img [src]="product.images && product.images.length ? product.images[0] : '/placeholder.jpg'"
               [alt]="product.productName"
               onerror="this.src='/assets/placeholder.jpg'"
               style="cursor: pointer;">
        </div>

        <!-- Product Info - Make product name clickable -->
        <div class="product-info">
          <h3 class="product-name" (click)="navigateToProductDetails(product.productId!)" style="cursor: pointer;">
            {{ product.productName }}
          </h3>

          <!-- Product Description -->
          <p class="product-description" *ngIf="product.description">
            {{ product.description | slice:0:100 }}{{ product.description && product.description.length > 100 ? '...' : '' }}
          </p>

          <div class="product-price">
            <span class="current-price" *ngIf="product.price">
              {{ product.price | currency }}
            </span>
          </div>

          <!-- Categories -->
          <div *ngIf="product.categories && product.categories.length > 0" class="product-categories">
            <span *ngFor="let category of product.categories; let last = last" class="category-tag">
              {{ category.categoryName }}<span *ngIf="!last">, </span>
            </span>
          </div>
        </div>

        <!-- Add View Details Button -->
        <div class="product-actions">
          <button class="view-details-btn" (click)="navigateToProductDetails(product.productId!)">
            View Details
          </button>
          <button (click)="removeFromWishlist(product.productId!)"
                  class="remove-btn"
                  title="Remove from wishlist"
                  [disabled]="!product.productId">
            Ã—
          </button>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !error && wishlistItems.length === 0" class="empty-state">
      <p>Your wishlist is empty</p>
      <a href="/products" class="shop-btn">Continue Shopping</a>
    </div>

    <!-- Pagination -->
    <div *ngIf="totalPages > 1" class="pagination">
      <button (click)="onPageChange(currentPage - 1)"
              [disabled]="currentPage === 0"
              class="page-btn">
        Previous
      </button>

      <button *ngFor="let page of pages"
              (click)="onPageChange(page)"
              [class]="'page-btn ' + (page === currentPage ? 'active' : '')"
              class="page-number">
        {{ page + 1 }}
      </button>

      <button (click)="onPageChange(currentPage + 1)"
              [disabled]="currentPage === totalPages - 1"
              class="page-btn">
        Next
      </button>
    </div>

    <!-- Results Info -->
    <div *ngIf="!loading && wishlistItems.length > 0" class="results-info">
      Showing {{ currentPage * pageSize + 1 }} -
      {{ Math.min((currentPage + 1) * pageSize, totalElements) }}
      of {{ totalElements }} items
    </div>
  </div>
</div>



